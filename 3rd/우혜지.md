# Chapter05 책임과 메시지

> 훌륭한 객체지향의 세계는 명확하게 정의된 역할과 책임을 지닌 객체들이 상호 협력하는 세계다.
> 

<br>

## 자율적인 책임

### 설계의 품질을 좌우하는 책임

- 객체들은 애플리케이션의 기능을 구현하기 위해 협력하고, 협력 과정에서 각자 맡은 바 책임을 다하기 위해 자율적으로 판단하고 행동한다.
- **자율적인 객체**란 스스로 정한 원칙에 따라 판단하고 스스로의 의지를 기반으로 행동하는 객체다.
- 객체가 어떤 행동을 하는 유일한 이유는 **다른 객체로부터 요청을 수신**했기 때문이다.
- 요청을 처리하기 위해 객체가 수행하는 행동을 **책임**이라고 한다.

### 자신의 의지에 따라 증언할 수 있는 자유

- 객체가 책임을 자율적으로 수행하기 위해서는 객체에게 할당되는 책임이 자율적이어야 한다.
- 객체가 자율적이기 위해서는 객체에게 할당되는 책임의 수준 역시 자율적이어야 한다.

```
1. 왕이 모자 장수에게 '증언하라'라는 요청을 했을 때

		모자 장수는 본인이 원하는 구체적인 방법이나 절차는 자유롭게 선택하도록 허용한다.
		최종적으로 왕이 만족할 만한 수준으로 증언할 수만 있다면 그 밖의 세부 사항에 대해서는
		무한대에 가까운 자율권을 누릴 수 있다.

2. 왕이 모자 장수에게 '목격했던 장면을 떠올려라', '떠오르는 기억을 시간 순서대로 재구성하라',
	'말로 간결하게 표현하라' 등 좀 더 상세한 수준으로 요청을 했을 때

		모자장수는 각각의 요청에 대해 책임이 생기기 때문에 
		증언하기 위해 선택할 수 있는 자유의 범위를 지나치게 제한받는다.
```

위의 예시를 보았을 때 두 번째 모자 장수는 책임을 수행하기 위해 자신의 의지나 판단력이 아닌 왕의 명령에 의존할 수밖에 없다. 결론적으로 자율적으로 책임을 수행할 수 없다.

### 너무 추상적인 책임

- 그러나 포괄적이고 추상적인 책임을 선택한다고 해서 무조건 좋은 것도 아니다.
- 너무 구체적인 것도 문제지만 **협력의 의도를 명확하게 표현하지 못할 정도로 추상적인 것 역시 문제**다.
- 책임은 **협력에 참여하는 의도를 명확하게 설명할 수 있는 수준 안에서 추상적**이어야 한다.
- 어떤 책임이 자율적인지를 판단하는 기준은 문맥에 따라 다르다.

```
3. 왕이 모자 장수에게 '설명하라'라는 요청을 했을 때

		모자 장수는 무엇을 설명해야 하는지 왕이 모자 장수에게 한 요청을 제대로 책임질 수 없다.

--> 그러나 재판이라는 협력 안에서는 '증언하라'라는 요청이 최선이지만, 
		다른 상황에서는 오히려 '설명하라'라는 책임이 자율권을 보장하는 최선의 선택이 될 수 있다.
```

### ‘어떻게’가 아니라 ‘무엇’을

- 자율적인 책임의 특징은 객체가 ‘어떻게(how)’ 해야 하는가가 아니라 ‘무엇(what)’을 해야 하는가를 설명한다는 것이다.

### 책임을 자극하는 메시지

- 책임이라는 말 속에는 어떤 행동을 수행한다는 의미가 포함돼 있다.
- 객체가 다른 객체에 접근할 수 있는 유일한 방법은 요청을 전송하는 것뿐이다.

<br>

## 메시지와 메서드

### 메시지

- 메시지는 객체들이 협력하기 위해 사용할 수 있는 유일한 의사소통 수단이다.
- 객체가 메시지를 수신할 수 있다는 것은 객체가 해당하는 책임을 수행할 수 있다는 것을 의미한다.
- 객체는 메시지를 처리하기 위한 방법을 자율적으로 선택할 수 있다.

### 메서드

- 메시지의 수신자 객체는 메시지를 처리할 방법으로 특정 메서드를 실행한다.
- 메시지의 수신자 객체가 런타임에 수행할 메서드를 결정하고 선택한다.

### 다형성

- 서로 다른 객체들이 다형성을 만족시킨다는 것은 객체들이 동일한 책임을 공유한다는 것을 의미한다.
- 서로 다른 타입의 객체들이 동일한 메시지에 대해 서로 다른 메서드를 이용해 메시지를 처리하는 메커니즘이다.
- 객체지향 패러다임이 강력한 이유는 다형성을 이용해 협력을 유연하게 만들 수 있기 때문이다.
- 다형성은 송신자와 수신자 간의 객체 타입에 대한 결합도를 메시지에 대한 결합도로 낮춤으로써 달성된다.

### 유연하고 확장 가능하고 재사용성이 높은 협력의 의미

1. 협력이 유연해진다.
2. 협력이 수행되는 방식을 확장할 수 있다.
3. 협력이 수행되는 방식을 재사용할 수 있다.

<br>

## 메시지를 따라라

- 객체지향 애플리케이션의 중심 사상은 **연쇄적으로 메시지를 전송**하고 수신하는 객체들 사이의 **협력 관계**를 기반으로 유용한 기능을 제공한다.
- 클래스가 코드를 구현하기 위해 사용할 수 있는 중요한 추상화 도구인 것은 사실이지만 객체지향의 강력함은 클래스가 아니라 객체들이 주고받는 메시지로부터 나온다.
- 클래스는 단지 동적인 객체들의 특성과 행위를 정적인 텍스트로 표현하기 위해 사용할 수 있는 **추상화 도구**일 뿐이다.

- **데이터-주도 설계**
    - 데이터를 중심으로 객체를 설계하는 방식은 객체의 내부 구조를 객체 정의의 일부로 만들기 때문에 객체의 자율성을 저해한다.
- **책임-주도 설계**
    - 객체들 간 주고받는 메시지를 기반으로 적절한 역할과 책임, 협력을 발견하는 것이 기본 아이디어이다.
    - **메시지**가 **수신자의 책임을 결정**한다.
    

### What/Who 사이클

- **‘어떤 행위(what)’**를 수행할 것인지를 결정한 후에 **‘누가(who)’** 그 행위를 수행할 것인지를 결정해야 한다.
- 협력이라는 문맥 안에서 객체의 책임을 결정하는 것은 **메시지**다. 
시스템이 수행해야 하는 전체 행위는 협력하는 객체들의 책임으로 분배된다.
- 수신 가능한 메시지가 모여 객체의 **인터페이스**를 구성한다.

### 묻지 말고 시켜라

- 메시지 중심의 설계는 메시지 수신자의 캡슐화를 증진시킨다.
- 송신자가 수신자의 내부 상태를 미리 알 수 없기 때문에 송신자와 수신자가 느슨하게 결합된다.
- 송신자는 수신자가 어떤 객체인지는 모르지만 자신이 전송한 메시지를 잘 처리할 것이라는 것을 믿고 메시지를 전송할 수밖에 없다.
- ‘어떻게’에서 ‘무엇’으로 전환하는 것은 객체 인터페이스의 크기를 급격하게 감소시킨다.
- 객체가 자신이 수신할 메시지를 결정하게 하지 말고 메시지가 협력에 필요한 객체를 발견하게 해야 한다.

> **결과적으로 ‘묻지 말고 시켜라’ 스타일은 객체를 자율적으로 만들고 캡슐화를 보장하며 결합도를 낮게 유지시켜 주기 때문에 설계를 유연하게 만든다.**
> 

<br>

## 객체 인터페이스

### 인터페이스

- 인터페이스란 어떤 두 사물이 마주치는 경계 지점에서 서로 상호작용할 수 있게 이어주는 방법이나 장치를 의미한다.
- 인터페이스의 특징은 다음과 같다.
    1. 인터페이스의 사용법을 익히기만 하면 내부 구조나 동작 방식을 몰라도 쉽게 대상을 조작하거나 의사를 전달할 수 있다.
    2. 인터페이스가 변경되지 않고 단순히 내부 구성이나 작동 방식이 변경되는 것은 인터페이스 사용자에게 아무런 영향도 미치지 않는다.
    3. 인터페이스가 동일하기만 하다면 어떤 대상과도 상호작용할 수 있다.
- 협력에 참여하는 객체 역시 인터페이스를 통해 다른 객체와 상호작용한다.

### 메시지가 인터페이스를 결정한다

- 객체의 인터페이스는 객체가 **수신할 수 있는 메시지**의 목록으로 구성된다.
- 객체가 어떤 메시지를 수신할 수 있는지가 객체가 제공하는 인터페이스의 모양을 결정한다.

### 공용 인터페이스

- 공용 인터페이스 : 객체가 외부로부터 수신할 수 있는 메시지
- 내부 인터페이스 : 객체가 자기 자신으로부터 주고받을 수 있는 메시지
- 공용 인터페이스는 객체의 외부와 내부를 명확하게 분리한다.

## 인터페이스와 구현의 분리

### 구현(Implementation)

- 구현 : 객체의 내부 구조와 작동 방식
- 객체의 외부와 내부를 분리하라 = 객체의 공용 인터페이스와 구현을 명확하게 분리하라

### 인터페이스와 구현의 분리 원칙

- 소프트웨어는 항상 변경되기 때문에, 객체의 내부 구현을 변경에 대한 안전 지대로 만들어 공용 인터페이스와 분리해야 한다.
- 객체 외부에 영향을 미치는 변경은 객체의 공용 인터페이스를 수정할 때뿐이어야 한다.
- 메시지와 송신자와 수신자가 구체적인 구현이 아니라 느슨한 인터페이스에 대해서만 결합되어야 한다.

### 캡슐화

- 캡슐화 : 객체의 자율성을 보존하기 위해 구현을 외부로부터 감추는 것
- 정보 은닉(information hiding)이라고 부르기도 한다.

**상태와 행위의 캡슐화**

- **데이터 캡슐화(data encapsulation)** 는 인터페이스와 구현을 분리하기 위한 전제 조건이다.
- 객체는 상태와 행위를 하나의 자율적인 단위로 묶은 후, 외부에서 반드시 접근해야만 하는 행위만 골라 공용 인터페이스에 노출한다.

**사적인 비밀의 캡슐화**

- 객체는 스스로 변경하고 조작할 수 있는 비밀, 즉 객체의 내부를 가지고 있다.
- 외부의 객체가 자신의 내부 상태를 직접 관찰하거나 제어할 수 없도록 공용 인터페이스를 경계 삼아 비밀을 격리한다.

<br>

## 책임의 자율성이 협력의 품질을 결정한다

1. 자율적인 책임은 협력을 단순하게 만든다. ⇒ **추상화**
2. 자율적인 책임은 모자 장수의 외부와 내부를 명확하게 분리한다. ⇒ **캡슐화**
3. 책임이 자율적일 경우 책임을 수행하는 내부적인 방법을 변경하더라도 외부에 영향을 미치지 않는다. ⇒ **결합도가 낮아진다.**
4. 자율적인 책임은 협력의 대상을 다양하게 선택할 수 있는 유연성을 제공한다. 
⇒ **설계가 유연해지고 재사용성이 높아진다.**
5. 객체가 수행하는 책임들이 자율적일수록 객체의 역할을 이해하기 쉬워진다. 
⇒ **객체의 응집도를 높은 상태로 유지하기가 쉬워진다.**
